/*! For license information please see taskpane.js.LICENSE.txt */
(()=>{function e(){var n,r,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",c=o.toStringTag||"@@toStringTag";function i(e,o,a,c){var i=o&&o.prototype instanceof u?o:u,l=Object.create(i.prototype);return t(l,"_invoke",function(e,t,o){var a,c,i,u=0,l=o||[],f=!1,m={p:0,n:0,v:n,a:d,f:d.bind(n,4),d:function(e,t){return a=e,c=0,i=n,m.n=t,s}};function d(e,t){for(c=e,i=t,r=0;!f&&u&&!o&&r<l.length;r++){var o,a=l[r],d=m.p,p=a[2];e>3?(o=p===t)&&(i=a[(c=a[4])?5:(c=3,3)],a[4]=a[5]=n):a[0]<=d&&((o=e<2&&d<a[1])?(c=0,m.v=t,m.n=a[1]):d<p&&(o=e<3||a[0]>t||t>p)&&(a[4]=e,a[5]=t,m.n=p,c=0))}if(o||e>1)return s;throw f=!0,t}return function(o,l,p){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,p),c=l,i=p;(r=c<2?n:i)||!f;){a||(c?c<3?(c>1&&(m.n=-1),d(c,i)):m.n=i:m.v=i);try{if(u=2,a){if(c||(o="next"),r=a[o]){if(!(r=r.call(a,i)))throw TypeError("iterator result is not an object");if(!r.done)return r;i=r.value,c<2&&(c=0)}else 1===c&&(r=a.return)&&r.call(a),c<2&&(i=TypeError("The iterator does not provide a '"+o+"' method"),c=1);a=n}else if((r=(f=m.n<0)?i:e.call(t,m))!==s)break}catch(e){a=n,c=1,i=e}finally{u=1}}return{value:r,done:f}}}(e,a,c),!0),l}var s={};function u(){}function l(){}function f(){}r=Object.getPrototypeOf;var m=[][a]?r(r([][a]())):(t(r={},a,function(){return this}),r),d=f.prototype=u.prototype=Object.create(m);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,t(e,c,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=f,t(d,"constructor",f),t(f,"constructor",l),l.displayName="GeneratorFunction",t(f,c,"GeneratorFunction"),t(d),t(d,c,"Generator"),t(d,a,function(){return this}),t(d,"toString",function(){return"[object Generator]"}),(e=function(){return{w:i,m:p}})()}function t(e,n,r,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}t=function(e,n,r,o){function c(n,r){t(e,n,function(e){return this._invoke(n,r,e)})}n?a?a(e,n,{value:r,enumerable:!o,configurable:!o,writable:!o}):e[n]=r:(c("next",0),c("throw",1),c("return",2))},t(e,n,r,o)}function n(e,t,n,r,o,a,c){try{var i=e[a](c),s=i.value}catch(e){return void n(e)}i.done?t(s):Promise.resolve(s).then(r,o)}function r(e){return function(){var t=this,r=arguments;return new Promise(function(o,a){var c=e.apply(t,r);function i(e){n(c,o,a,i,s,"next",e)}function s(e){n(c,o,a,i,s,"throw",e)}i(void 0)})}}var o="",a={gemini:{name:"Gemini",keyStorage:"gemini_api_key"},openai:{name:"OpenAI",keyStorage:"openai_api_key"}};function c(){return document.getElementById("provider-select").value}function i(){var e=c(),t=a[e];document.getElementById("api-key-label").innerText="".concat(t.name," API Key:");var n=localStorage.getItem(t.keyStorage)||"";document.getElementById("api-key").value=n}function s(){return u.apply(this,arguments)}function u(){return(u=r(e().m(function t(){var n,r,i,s,u,l,f,m;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=document.getElementById("description").value,r=document.getElementById("api-key").value,i=c(),s=document.getElementById("message-area"),u=document.getElementById("result-section"),l=document.getElementById("formula-preview"),n){e.n=1;break}return s.innerText="Please enter a description.",e.a(2);case 1:if(r){e.n=2;break}return s.innerText="Please enter your ".concat(a[i].name," API Key in settings."),e.a(2);case 2:return s.innerText="Generating...",u.classList.add("hidden"),e.p=3,e.n=4,d(n,r,i);case 4:f=e.v,o=f,l.innerText=f,u.classList.remove("hidden"),s.innerText="",e.n=6;break;case 5:e.p=5,m=e.v,console.error(m),s.innerText="Error: "+m.message;case 6:return e.a(2)}},t,null,[[3,5]])}))).apply(this,arguments)}function l(){return f.apply(this,arguments)}function f(){return f=r(e().m(function t(){return e().w(function(t){for(;;)switch(t.p=t.n){case 0:if(o){t.n=1;break}return t.a(2);case 1:return t.p=1,t.n=2,Excel.run(function(){var t=r(e().m(function t(n){return e().w(function(e){for(;;)switch(e.n){case 0:return n.workbook.getSelectedRange().formulas=[[o]],e.n=1,n.sync();case 1:return e.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}());case 2:t.n=4;break;case 3:t.p=3,t.v,Office.context.document.setSelectedDataAsync(o,{coercionType:Office.CoercionType.Text},function(e){e.status===Office.AsyncResultStatus.Failed&&(document.getElementById("message-area").innerText="Error inserting: "+e.error.message)});case 4:return t.a(2)}},t,null,[[1,3]])})),f.apply(this,arguments)}function m(){var e=c(),t=document.getElementById("api-key").value;localStorage.setItem(a[e].keyStorage,t),document.getElementById("message-area").innerText="".concat(a[e].name," Key saved."),setTimeout(function(){document.getElementById("message-area").innerText=""},2e3)}function d(e,t,n){return p.apply(this,arguments)}function p(){return(p=r(e().m(function t(n,r,o){var a,c,i,s,u,l,f,m,d,p;return e().w(function(e){for(;;)switch(e.n){case 0:if(a="You are an expert Excel assistant. User will ask for a formula. Output ONLY the Excel formula, starting with =. Do not explain. If the request is not clear, guess the most likely standard formula.","gemini"!==o){e.n=5;break}return c="https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=".concat(r),e.n=1,fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:"".concat(a,"\n\n").concat(n)}]}]})});case 1:if((i=e.v).ok){e.n=3;break}return e.n=2,i.json();case 2:throw s=e.v,new Error(s.error&&s.error.message||"Gemini Error: ".concat(i.status));case 3:return e.n=4,i.json();case 4:return u=e.v,l=u.candidates&&u.candidates[0]&&u.candidates[0].content&&u.candidates[0].content.parts&&u.candidates[0].content.parts[0]&&u.candidates[0].content.parts[0].text||"",e.a(2,y(l));case 5:if("openai"!==o){e.n=10;break}return e.n=6,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(r)},body:JSON.stringify({model:"gpt-4o-mini",messages:[{role:"system",content:a},{role:"user",content:n}]})});case 6:if((f=e.v).ok){e.n=8;break}return e.n=7,f.json();case 7:throw m=e.v,d=m.error&&m.error.message||"OpenAI Error: ".concat(f.status),new Error(d);case 8:return e.n=9,f.json();case 9:return p=e.v,e.a(2,y(p.choices[0].message.content));case 10:return e.a(2)}},t)}))).apply(this,arguments)}function y(e){var t=e.trim();return t.startsWith("```")&&(t=t.replace(/^```(excel)?\s*/,"").replace(/\s*```$/,"")),t}function g(){return v.apply(this,arguments)}function v(){return(v=r(e().m(function t(){var n,r,o,a,c;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(n=document.getElementById("api-key").value){e.n=1;break}return console.log("No API key found for debug listing."),e.a(2);case 1:return e.p=1,e.n=2,fetch("https://generativelanguage.googleapis.com/v1beta/models?key=".concat(n));case 2:return r=e.v,e.n=3,r.json();case 3:o=e.v,console.log("DEBUG: Available Models for this key:",o),o.models&&(a=o.models.map(function(e){return e.name}),console.log("DEBUG: Model Names:",a),document.getElementById("message-area").innerText+="\n(Check console for available models)"),e.n=5;break;case 4:e.p=4,c=e.v,console.error("DEBUG: Failed to list models",c);case 5:return e.a(2)}},t,null,[[1,4]])}))).apply(this,arguments)}Office.onReady(function(e){e.host===Office.HostType.Excel&&(document.getElementById("generate-btn").onclick=s,document.getElementById("insert-btn").onclick=l,document.getElementById("save-key-btn").onclick=m,document.getElementById("provider-select").onchange=i,i())}),document.getElementById("save-key-btn").addEventListener("click",g),setTimeout(g,2e3)})();
//# sourceMappingURL=taskpane.js.map