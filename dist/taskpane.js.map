{"version":3,"file":"taskpane.js","mappings":"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","sources":["webpack://excel-agent-project/./src/taskpane/taskpane.js"],"sourcesContent":["/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved. Licensed under the MIT license.\r\n * See LICENSE in the project root for license information.\r\n */\r\n\r\n// Global variable to store the latest generated formula\r\nlet lastGeneratedFormula = \"\";\r\n\r\n// Import Gemini SDK\r\n// import { GoogleGenerativeAI } from \"@google/generative-ai\";\r\n\r\nconst PROVIDERS = {\r\n    gemini: { name: \"Gemini\", keyStorage: \"gemini_api_key\" },\r\n    openai: { name: \"OpenAI\", keyStorage: \"openai_api_key\" }\r\n};\r\n\r\nOffice.onReady((info) => {\r\n    if (info.host === Office.HostType.Excel) {\r\n        document.getElementById(\"generate-btn\").onclick = generateFormula;\r\n        document.getElementById(\"insert-btn\").onclick = insertFormula;\r\n        document.getElementById(\"save-key-btn\").onclick = saveApiKey;\r\n        document.getElementById(\"provider-select\").onchange = updateProviderUI;\r\n\r\n        // Initialize UI\r\n        updateProviderUI();\r\n    }\r\n});\r\n\r\nfunction getSelectedProvider() {\r\n    return document.getElementById(\"provider-select\").value;\r\n}\r\n\r\nfunction updateProviderUI() {\r\n    const provider = getSelectedProvider();\r\n    const config = PROVIDERS[provider];\r\n\r\n    document.getElementById(\"api-key-label\").innerText = `${config.name} API Key:`;\r\n\r\n    // Load saved key\r\n    const savedKey = localStorage.getItem(config.keyStorage) || \"\";\r\n    document.getElementById(\"api-key\").value = savedKey;\r\n}\r\n\r\nasync function generateFormula() {\r\n    const description = document.getElementById(\"description\").value;\r\n    const apiKey = document.getElementById(\"api-key\").value;\r\n    const provider = getSelectedProvider();\r\n    const messageArea = document.getElementById(\"message-area\");\r\n    const resultSection = document.getElementById(\"result-section\");\r\n    const formulaPreview = document.getElementById(\"formula-preview\");\r\n\r\n    if (!description) {\r\n        messageArea.innerText = \"Please enter a description.\";\r\n        return;\r\n    }\r\n    if (!apiKey) {\r\n        messageArea.innerText = `Please enter your ${PROVIDERS[provider].name} API Key in settings.`;\r\n        return;\r\n    }\r\n\r\n    messageArea.innerText = \"Generating...\";\r\n    resultSection.classList.add(\"hidden\");\r\n\r\n    try {\r\n        const formula = await callLLM(description, apiKey, provider);\r\n        lastGeneratedFormula = formula;\r\n        formulaPreview.innerText = formula;\r\n        resultSection.classList.remove(\"hidden\");\r\n        messageArea.innerText = \"\";\r\n    } catch (error) {\r\n        console.error(error);\r\n        messageArea.innerText = \"Error: \" + error.message;\r\n    }\r\n}\r\n\r\nasync function insertFormula() {\r\n    if (!lastGeneratedFormula) return;\r\n\r\n    try {\r\n        await Excel.run(async (context) => {\r\n            const range = context.workbook.getSelectedRange();\r\n            range.formulas = [[lastGeneratedFormula]];\r\n            await context.sync();\r\n        });\r\n    } catch (error) {\r\n        // Fallback for older Excel versions or other contexts\r\n        Office.context.document.setSelectedDataAsync(\r\n            lastGeneratedFormula,\r\n            { coercionType: Office.CoercionType.Text },\r\n            (asyncResult) => {\r\n                if (asyncResult.status === Office.AsyncResultStatus.Failed) {\r\n                    document.getElementById(\"message-area\").innerText = \"Error inserting: \" + asyncResult.error.message;\r\n                }\r\n            }\r\n        );\r\n    }\r\n}\r\n\r\nfunction saveApiKey() {\r\n    const provider = getSelectedProvider();\r\n    const key = document.getElementById(\"api-key\").value;\r\n    localStorage.setItem(PROVIDERS[provider].keyStorage, key);\r\n\r\n    document.getElementById(\"message-area\").innerText = `${PROVIDERS[provider].name} Key saved.`;\r\n    setTimeout(() => {\r\n        document.getElementById(\"message-area\").innerText = \"\";\r\n    }, 2000);\r\n}\r\n\r\nasync function callLLM(prompt, apiKey, provider) {\r\n    const systemPrompt = \"You are an expert Excel assistant. User will ask for a formula. Output ONLY the Excel formula, starting with =. Do not explain. If the request is not clear, guess the most likely standard formula.\";\r\n\r\n    if (provider === \"gemini\") {\r\n        const url = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;\r\n        const response = await fetch(url, {\r\n            method: \"POST\",\r\n            headers: { \"Content-Type\": \"application/json\" },\r\n            body: JSON.stringify({\r\n                contents: [{\r\n                    parts: [{ text: `${systemPrompt}\\n\\n${prompt}` }]\r\n                }]\r\n            })\r\n        });\r\n\r\n        if (!response.ok) {\r\n            const errorData = await response.json();\r\n            throw new Error((errorData.error && errorData.error.message) || `Gemini Error: ${response.status}`);\r\n        }\r\n\r\n        const data = await response.json();\r\n        const text = (data.candidates && data.candidates[0] && data.candidates[0].content && data.candidates[0].content.parts && data.candidates[0].content.parts[0] && data.candidates[0].content.parts[0].text) || \"\";\r\n        return cleanFormula(text);\r\n    } else if (provider === \"openai\") {\r\n        const response = await fetch(\"https://api.openai.com/v1/chat/completions\", {\r\n            method: \"POST\",\r\n            headers: {\r\n                \"Content-Type\": \"application/json\",\r\n                \"Authorization\": `Bearer ${apiKey}`\r\n            },\r\n            body: JSON.stringify({\r\n                model: \"gpt-4o-mini\",\r\n                messages: [\r\n                    { role: \"system\", content: systemPrompt },\r\n                    { role: \"user\", content: prompt }\r\n                ]\r\n            })\r\n        });\r\n\r\n        if (!response.ok) {\r\n            const errorData = await response.json();\r\n            const msg = (errorData.error && errorData.error.message) || `OpenAI Error: ${response.status}`;\r\n            throw new Error(msg);\r\n        }\r\n\r\n        const data = await response.json();\r\n        return cleanFormula(data.choices[0].message.content);\r\n    }\r\n}\r\n\r\nfunction cleanFormula(text) {\r\n    let content = text.trim();\r\n    if (content.startsWith(\"```\")) {\r\n        content = content.replace(/^```(excel)?\\s*/, \"\").replace(/\\s*```$/, \"\");\r\n    }\r\n    return content;\r\n}\r\n\r\n\r\n// DEBUG: List available models\r\nasync function listAvailableModels() {\r\n    const apiKey = document.getElementById(\"api-key\").value;\r\n    if (!apiKey) {\r\n        console.log(\"No API key found for debug listing.\");\r\n        return;\r\n    }\r\n\r\n    try {\r\n        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models?key=${apiKey}`);\r\n        const data = await response.json();\r\n        console.log(\"DEBUG: Available Models for this key:\", data);\r\n        if (data.models) {\r\n            const names = data.models.map(m => m.name);\r\n            console.log(\"DEBUG: Model Names:\", names);\r\n            document.getElementById(\"message-area\").innerText += \"\\n(Check console for available models)\";\r\n        }\r\n    } catch (e) {\r\n        console.error(\"DEBUG: Failed to list models\", e);\r\n    }\r\n}\r\n\r\n// Call on saved key\r\ndocument.getElementById(\"save-key-btn\").addEventListener('click', listAvailableModels);\r\n// Try on load\r\nsetTimeout(listAvailableModels, 2000); // Give time for value to populate\r\n\r\n"],"names":["e","t","r","Symbol","n","iterator","o","toStringTag","i","c","prototype","Generator","u","Object","create","_regeneratorDefine2","f","p","y","G","v","a","d","bind","length","l","TypeError","call","done","value","GeneratorFunction","GeneratorFunctionPrototype","getPrototypeOf","setPrototypeOf","__proto__","displayName","_regenerator","w","m","defineProperty","_invoke","enumerable","configurable","writable","asyncGeneratorStep","Promise","resolve","then","_asyncToGenerator","arguments","apply","_next","_throw","lastGeneratedFormula","PROVIDERS","gemini","name","keyStorage","openai","getSelectedProvider","document","getElementById","updateProviderUI","provider","config","innerText","concat","savedKey","localStorage","getItem","generateFormula","_generateFormula","_callee","description","apiKey","messageArea","resultSection","formulaPreview","formula","_t","_context","classList","add","callLLM","remove","console","error","message","insertFormula","_insertFormula","_callee3","_context3","Excel","run","_ref","_callee2","context","_context2","workbook","getSelectedRange","formulas","sync","_x4","Office","setSelectedDataAsync","coercionType","CoercionType","Text","asyncResult","status","AsyncResultStatus","Failed","saveApiKey","key","setItem","setTimeout","_x","_x2","_x3","_callLLM","_callee4","prompt","systemPrompt","url","response","errorData","data","text","_response","_errorData","msg","_data","_context4","fetch","method","headers","body","JSON","stringify","contents","parts","ok","json","Error","candidates","content","cleanFormula","model","messages","role","choices","trim","startsWith","replace","listAvailableModels","_listAvailableModels","_callee5","names","_t3","_context5","log","models","map","onReady","info","host","HostType","onclick","onchange","addEventListener"],"ignoreList":[],"sourceRoot":""}